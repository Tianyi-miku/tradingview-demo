from flask import Flask
from flask import jsonify
from flask_cors import CORS
from flask import request
import tushare as ts
import pandas as pd
import numpy as np

app = Flask(__name__)
CORS(app, resources=r'/*')
# 因为Token积分原因，次数不够，测试用的是模拟查询的数据，与查询的数据保持一致！
pro = ts.pro_api('7bdb92642d946229765ed2c1878ea94361de1fbe800be8d7589e4e02')


@app.route('/')
def hello_world():
    return 'Hello World!'


@app.route('/getStockList', methods=['GET'])
def stockList():

    df = {'ts_code': ['000001.SZ'], 'symbol': ['000001'], 'name': [
        '平安银行'], 'area': ['深圳'], 'industry': ['银行'], 'list_date': ['19910403']}
    data = pd.DataFrame(df)
    list = data.to_dict('records')
    return list


@app.route('/getHistaryData', methods=['GET'])
def histaryData():

    code = request.args.get('ts_code')
    start_date = request.args.get('start_date')
    end_date = request.args.get('end_date')
    df = {'amount': ['1491327.713', '1573229.042', '2077194.138', '1931983.482', '1345053.255',
                     '1740107.625', '2177632.043', '2442932.842', '3201454.164', '1723394.336',
                     '1150933.398', '1442171.431', '1226464.649', '995909.007',  '1678888.507',
                     '1424889.228', '2217608.852', '1468271.683', '975154.818',  '1725326.806',
                     '1423608.811', '1247047.135', '1477930.193', '1914495.474', '2571196.482',
                     '1154704.348', '1603152.786', '1741473.179', '610381.757',  '679664.596',
                     '752351.618',  '1173372.08',  '1067869.779', '1119925.969', '1317608.543',
                     '1969891.323', '1262802.471', '1680707.282', '747519.511',  '1351786.53',
                     '851377.532',  '935135.952',  '1109423.061', '857682.575',  '802110.334',
                     '700293.548',  '849784.129',  '1001451.096', '585252.046',  '736584.294',
                     '1271594.662', '1233388.886', '1216064.537', '1218516.399', '2747598.383',
                     '920998.203',  '915983.935',  '933539.572',  '767006.342',  '1067975.601',
                     '840769.286',  '1556517.253', '1421088.326', '1200671.649', '1470233.502',
                     '2010924.199', '1507910.818', '2096068.96',  '1407006.434', '1420644.944',
                     '1322036.352', '1780873.358', '1161100.08',  '1861032.918', '1590781.971',
                     '3072547.165', '1589276.085', '1999012.671', '1887045.621', '2146150.627',
                     '1503633.369', '2688929.547', '2335030.599', '1418751.875', '2145061.763',
                     '2225024.598', '1645828.526', '1598567.052', '2673096.951', '3024598.93',
                     '1726238.272', '2148740.448', '4020646.521', '2777383.508', '1179079.988',
                     '1261416.554', '1349401.481', '1682911.849', '1192674.258', '1155180.739'],
          'change': ['-0.12', '-0.02', '0.29',  '-0.12', '-0.15', '0.14',  '0.03',
                     '0.61',  '-1.55', '-0.55', '0.09',  '-0.45', '0.06',  '0.06',
                     '-0.19', '-0.24', '-0.23', '0.3',   '-0.1',  '0.13',  '-0.49',
                     '0.08',  '-0.11', '0.31',  '0.42',  '-0.12', '-0.06', '0.16',
                     '0.17',  '-0.1',  '0.16',  '-0.35', '0.04',  '0.09',  '-0.04',
                     '0.37',  '0.01',  '0.52',  '-0.06', '0.33',  '-0.08', '-0.19',
                     '0.17',  '0.12',  '-0.14', '0.09',  '0.07',  '-0.2',  '0.02',
                     '-0.15', '-0.18', '0.21',  '-0.27', '0.01',  '-0.56', '-0.04',
                     '0.11',  '0.02',  '-0.01', '0',     '0.05',  '-0.37', '-0.24',
                     '-0.07', '-0.19', '0.23',  '0.06',  '0.6',   '-0.17', '-0.48',
                     '0.25',  '-0.22', '0.01',  '0.42',  '0.03',  '-0.47', '0.38',
                     '-0.19', '-0.09', '-0.39', '-0.04', '0.41',  '0.57',  '-0.01',
                     '0.05',  '0.61',  '-0.31', '0.19',  '-0.04', '0.57',  '-0.2',
                     '0.04',  '0.5',   '0.43',  '0.17',  '-0.21', '-0.23', '0.12',
                     '0.01',  '-0.14'],
          'close': ['14.65', '14.77', '14.79', '14.5',  '14.62', '14.77', '14.63',
                    '14.6',  '13.99', '15.54', '16.09', '16',    '16.45', '16.39',
                    '16.33', '16.52', '16.76', '16.99', '16.69', '16.79', '16.66',
                    '17.15', '17.07', '17.18', '16.87', '16.45', '16.57', '16.63',
                    '16.47', '16.3',  '16.4',  '16.24', '16.59', '16.55', '16.46',
                    '16.5',  '16.13', '16.12', '15.6',  '15.66', '15.33', '15.41',
                    '15.6',  '15.43', '15.31', '15.45', '15.36', '15.29', '15.49',
                    '15.47', '15.62', '15.8',  '15.59', '15.86', '15.85', '16.41',
                    '16.45', '16.34', '16.32', '16.33', '16.33', '16.28', '16.65',
                    '16.89', '16.96', '17.15', '16.92', '16.86', '16.26', '16.43',
                    '16.91', '16.66', '16.88', '16.87', '16.45', '16.42', '16.89',
                    '16.51', '16.7',  '16.79', '17.18', '17.22', '16.81', '16.24',
                    '16.25', '16.2',  '15.59', '15.9',  '15.71', '15.75', '15.18',
                    '15.38', '15.34', '14.84', '14.41', '14.24', '14.45', '14.68',
                    '14.56', '14.55'],
          'high': ['14.88', '14.82', '14.94', '14.53', '14.69', '14.87', '14.89',
                   '14.66', '14.7',  '15.92', '16.16', '16.34', '16.61', '16.55',
                   '16.57', '16.86', '17.27', '17.03', '16.81', '16.93', '17.05',
                   '17.28', '17.34', '17.31', '16.95', '16.63', '16.63', '16.93',
                   '16.48', '16.56', '16.5',  '16.68', '16.68', '16.74', '16.66',
                   '16.63', '16.14', '16.12', '15.67', '15.68', '15.38', '15.62',
                   '15.72', '15.48', '15.41', '15.46', '15.43', '15.55', '15.54',
                   '15.64', '15.89', '15.84', '15.92', '15.87', '16.3',  '16.48',
                   '16.55', '16.55', '16.48', '16.46', '16.37', '16.53', '17.02',
                   '17.07', '17.26', '17.44', '17.25', '17',    '16.47', '16.96',
                   '16.93', '17.04', '16.96', '17',    '16.67', '16.93', '16.97',
                   '17.04', '17',    '17.44', '17.35', '17.6',  '16.95', '16.27',
                   '16.52', '16.23', '15.89', '16',    '16.04', '15.85', '15.54',
                   '15.47', '15.4',  '14.89', '14.48', '14.45', '14.72', '14.78',
                   '14.71', '14.64'],
          'low': ['14.61', '14.6',  '14.56', '14.3',  '14.41', '14.51', '14.32',
                  '14.02', '13.99', '15.39', '15.71', '15.93', '16.35', '16.35',
                  '16.2',  '16.45', '16.76', '16.61', '16.52', '16.53', '16.63',
                  '16.95', '16.91', '16.92', '16.55', '16.31', '16.1',  '16.43',
                  '16.32', '16.24', '16.23', '16.17', '16.44', '16.44', '16.41',
                  '15.98', '15.87', '15.77', '15.53', '15.3',  '15.25', '15.35',
                  '15.46', '15.3',  '15.21', '15.21', '15.23', '15.18', '15.44',
                  '15.39', '15.49', '15.54', '15.55', '15.63', '15.77', '16.31',
                  '16.23', '16.24', '16.25', '16.06', '16.16', '16.2',  '16.64',
                  '16.75', '16.88', '16.79', '16.77', '16.28', '16.24', '16.42',
                  '16.56', '16.48', '16.58', '16.44', '16.23', '16.03', '16.43',
                  '16.43', '16.55', '16.63', '16.82', '16.92', '16.2',  '15.99',
                  '16.02', '15.6',  '15.57', '15.7',  '15.66', '15.19', '15.18',
                  '15.18', '14.93', '14.48', '14.24', '14.18', '14.4',  '14.53',
                  '14.46', '14.41'],
          'open': ['14.71', '14.79', '14.6',  '14.51', '14.6',  '14.81', '14.59',
                   '14.05', '13.99', '15.92', '15.92', '16.34', '16.43', '16.38',
                   '16.52', '16.79', '16.99', '16.75', '16.79', '16.81', '17',
                   '17.13', '17.01', '16.94', '16.65', '16.57', '16.46', '16.53',
                   '16.34', '16.45', '16.23', '16.68', '16.55', '16.55', '16.43',
                   '16',    '16.12', '15.85', '15.66', '15.38', '15.36', '15.62',
                   '15.47', '15.35', '15.34', '15.3',  '15.35', '15.54', '15.47',
                   '15.64', '15.89', '15.64', '15.89', '15.75', '16.3',  '16.45',
                   '16.35', '16.39', '16.43', '16.29', '16.29', '16.5',  '16.98',
                   '16.93', '17.06', '16.8',  '16.98', '16.35', '16.42', '16.8',
                   '16.69', '16.98', '16.78', '16.5',  '16.32', '16.91', '16.43',
                   '16.8',  '16.9',  '17.26', '17.25', '16.97', '16.2',  '16.27',
                   '16.1',  '15.6',  '15.75', '15.85', '15.86', '15.2',  '15.47',
                   '15.34', '14.95', '14.48', '14.24', '14.36', '14.7',  '14.66',
                   '14.6',  '14.6'],
          'pct_chg': ['-0.8125', '-0.1352', '2',       '-0.8208', '-1.0156', '0.9569',
                      '0.2055',  '4.3603',  '-9.9743', '-3.4183', '0.5625',  '-2.7356',
                      '0.3661',  '0.3674',  '-1.1501', '-1.432',  '-1.3537', '1.7975',
                      '-0.5956', '0.7803',  '-2.8571', '0.4687',  '-0.6403', '1.8376',
                      '2.5532',  '-0.7242', '-0.3608', '0.9715',  '1.0429',  '-0.6098',
                      '0.9852',  '-2.1097', '0.2417',  '0.5468',  '-0.2424', '2.2939',
                      '0.062',   '3.3333',  '-0.3831', '2.1526',  '-0.5191', '-1.2179',
                      '1.1017',  '0.7838',  '-0.9061', '0.5859',  '0.4578',  '-1.2912',
                      '0.1293',  '-0.9603', '-1.1392', '1.347',   '-1.7024', '0.0631',
                      '-3.4126', '-0.2432', '0.6732',  '0.1225',  '-0.0612', '0',
                      '0.3071',  '-2.2222', '-1.421',  '-0.4127', '-1.1079', '1.3593',
                      '0.3559',  '3.69',    '-1.0347', '-2.8386', '1.5006',  '-1.3033',
                      '0.0593',  '2.5532',  '0.1827',  '-2.7827', '2.3016',  '-1.1377',
                      '-0.536',  '-2.2701', '-0.2323', '2.439',   '3.5099',  '-0.0615',
                      '0.3086',  '3.9128',  '-1.9497', '1.2094',  '-0.254',  '3.7549',
                      '-1.3004', '0.2608',  '3.3693',  '2.984',   '1.1938',  '-1.4533',
                      '-1.5668', '0.8242',  '0.0687',  '-0.953'],
          'pre_close': ['14.77', '14.79', '14.5',  '14.62', '14.77', '14.63', '14.6',
                        '13.99', '15.54', '16.09', '16',    '16.45', '16.39', '16.33',
                        '16.52', '16.76', '16.99', '16.69', '16.79', '16.66', '17.15',
                        '17.07', '17.18', '16.87', '16.45', '16.57', '16.63', '16.47',
                        '16.3',  '16.4',  '16.24', '16.59', '16.55', '16.46', '16.5',
                        '16.13', '16.12', '15.6',  '15.66', '15.33', '15.41', '15.6',
                        '15.43', '15.31', '15.45', '15.36', '15.29', '15.49', '15.47',
                        '15.62', '15.8',  '15.59', '15.86', '15.85', '16.41', '16.45',
                        '16.34', '16.32', '16.33', '16.33', '16.28', '16.65', '16.89',
                        '16.96', '17.15', '16.92', '16.86', '16.26', '16.43', '16.91',
                        '16.66', '16.88', '16.87', '16.45', '16.42', '16.89', '16.51',
                        '16.7',  '16.79', '17.18', '17.22', '16.81', '16.24', '16.25',
                        '16.2',  '15.59', '15.9',  '15.71', '15.75', '15.18', '15.38',
                        '15.34', '14.84', '14.41', '14.24', '14.45', '14.68', '14.56',
                        '14.55', '14.69'],
          'trade_date': ['20220213', '20200212', '20200211', '20200210', '20200207',
                         '20200206', '20200205', '20200204', '20200203', '20200123',
                         '20200122', '20200121', '20200120', '20200117', '20200116',
                         '20200115', '20200114', '20200113', '20200110', '20200109',
                         '20200108', '20200107', '20200106', '20200103', '20200102',
                         '20191231', '20191230', '20191227', '20191226', '20191225',
                         '20191224', '20191223', '20191220', '20191219', '20191218',
                         '20191217', '20191216', '20191213', '20191212', '20191211',
                         '20191210', '20191209', '20191206', '20191205', '20191204',
                         '20191203', '20191202', '20191129', '20191128', '20191127',
                         '20191126', '20191125', '20191122', '20191121', '20191120',
                         '20191119', '20191118', '20191115', '20191114', '20191113',
                         '20191112', '20191111', '20191108', '20191107', '20191106',
                         '20191105', '20191104', '20191101', '20191031', '20191030',
                         '20191029', '20191028', '20191025', '20191024', '20191023',
                         '20191022', '20191021', '20191018', '20191017', '20191016',
                         '20191015', '20191014', '20191011', '20191010', '20191009',
                         '20191008', '20190930', '20190927', '20190926', '20190925',
                         '20190924', '20190923', '20190920', '20190919', '20190918',
                         '20190917', '20190916', '20190912', '20190911', '20190910'],
          'ts_code': ['000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ',
                      '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ', '000001.SZ'],
          'vol': ['1013205.28', '1070503.21', '1407507.44', '1339495.24', '924852.96',
                  '1185815.72', '1491380.21', '1706172.07', '2259194.83', '1100592.07',
                  '719464.91',  '896603.1',   '746074.75',  '605436.69',  '1028104.67',
                  '859439.12',  '1304493.66', '872133.36',  '585548.45',  '1031636.65',
                  '847824.12',  '728607.56',  '862083.5',   '1116194.81', '1530231.87',
                  '704442.25',  '976970.31',  '1042574.72', '372033.86',  '414917.98',
                  '459128.42',  '715792.72',  '644478.38',  '675536.76',  '797091.33',
                  '1203104.9',  '787952.34',  '1053103.81', '478998.82',  '871505.19',
                  '556383.88',  '605992.89',  '712615.24',  '557084.46',  '524545.27',
                  '455418.05',  '553877.38',  '653866.91',  '378016.51',  '476169.98',
                  '815297.53',  '783257.94',  '773473.54',  '772563.24',  '1724383.53',
                  '562120.4',   '557918.41',  '569227.98',  '468899.55',  '655120.65',
                  '516266.4',   '953515.63',  '849139.24',  '711896.99',  '863325.36',
                  '1172485.89', '889824.25',  '1254655.44', '862569.3',   '854317.17',
                  '788864.73',  '1070131.13', '691435.76',  '1109214.77', '967534.59',
                  '1883531.43', '945952.25',  '1196799.14', '1126182.22', '1267671.21',
                  '881955.42',  '1557637.45', '1405422.82', '879746.62',  '1316693.41',
                  '1386676.36', '1046363.17', '1007706.27', '1686592.58', '1938892.72',
                  '1129103.24', '1403282',    '2644285.14', '1884020.83', '820436.33',
                  '882655.75',  '929894.14',  '1150687.64', '818614.21',  '796870.64']
          }
    data = pd.DataFrame(df)
    # 过滤数据
    df = data.sort_values(by='trade_date', axis=0)
    df = df.loc[df["trade_date"].between(start_date, end_date)]
    if df.empty:
        list = []
    else:
        list = df.to_dict('records')
    return list


# 启动运行
if __name__ == '__main__':
    app.run()   # 直接运行在本地服务器
